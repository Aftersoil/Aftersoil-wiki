<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node | Aftersoil-wiki</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon/chrome-192x192.png">
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?69622073a8649e8a707a918060cc1abc";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script>
    <meta name="description" content="后土维基 | 后土文档 | Aftersoil | Aftersoil-wiki">
    <meta name="theme-color" content="#663403">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="baidu-site-verification" content="code-6uTgqJ41VJ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta HTTP-EQUIV="pragma" content="no-cache">
    <meta HTTP-EQUIV="Cache-Control" content="no-store, must-revalidate">
    <meta HTTP-EQUIV="expires" content="Wed, 26 Feb 1997 08:21:57 GMT">
    <meta HTTP-EQUIV="expires" content="0">
    <link rel="preload" href="/assets/css/0.styles.5dc1cf24.css" as="style"><link rel="preload" href="/assets/js/app.89c9a8ed.js" as="script"><link rel="preload" href="/assets/js/2.cfe6598b.js" as="script"><link rel="preload" href="/assets/js/43.58f28757.js" as="script"><link rel="preload" href="/assets/js/3.fb60532c.js" as="script"><link rel="prefetch" href="/assets/js/10.9d78825f.js"><link rel="prefetch" href="/assets/js/100.100c5992.js"><link rel="prefetch" href="/assets/js/101.a505a26b.js"><link rel="prefetch" href="/assets/js/102.29123e5a.js"><link rel="prefetch" href="/assets/js/103.aea29c65.js"><link rel="prefetch" href="/assets/js/104.d858d7d7.js"><link rel="prefetch" href="/assets/js/11.87313a1f.js"><link rel="prefetch" href="/assets/js/12.91833bed.js"><link rel="prefetch" href="/assets/js/13.397cd5f3.js"><link rel="prefetch" href="/assets/js/14.7af2e6f6.js"><link rel="prefetch" href="/assets/js/15.9e1d8cc1.js"><link rel="prefetch" href="/assets/js/16.cbf0f6cd.js"><link rel="prefetch" href="/assets/js/17.69b5b435.js"><link rel="prefetch" href="/assets/js/18.e5092e77.js"><link rel="prefetch" href="/assets/js/19.40f29e2c.js"><link rel="prefetch" href="/assets/js/20.f89a4a51.js"><link rel="prefetch" href="/assets/js/21.9c41aff3.js"><link rel="prefetch" href="/assets/js/22.642684cd.js"><link rel="prefetch" href="/assets/js/23.1b5147ba.js"><link rel="prefetch" href="/assets/js/24.1664e18a.js"><link rel="prefetch" href="/assets/js/25.7ca8fd9a.js"><link rel="prefetch" href="/assets/js/26.70bc6223.js"><link rel="prefetch" href="/assets/js/27.a1091949.js"><link rel="prefetch" href="/assets/js/28.d00f916c.js"><link rel="prefetch" href="/assets/js/29.d376eb2a.js"><link rel="prefetch" href="/assets/js/30.b1584db9.js"><link rel="prefetch" href="/assets/js/31.f09e668a.js"><link rel="prefetch" href="/assets/js/32.c83fd1ba.js"><link rel="prefetch" href="/assets/js/33.586c0da7.js"><link rel="prefetch" href="/assets/js/34.38534a26.js"><link rel="prefetch" href="/assets/js/35.15eb8085.js"><link rel="prefetch" href="/assets/js/36.db494491.js"><link rel="prefetch" href="/assets/js/37.36d6230b.js"><link rel="prefetch" href="/assets/js/38.37705383.js"><link rel="prefetch" href="/assets/js/39.0a27afbf.js"><link rel="prefetch" href="/assets/js/4.5ff013ef.js"><link rel="prefetch" href="/assets/js/40.e990530a.js"><link rel="prefetch" href="/assets/js/41.3de355f5.js"><link rel="prefetch" href="/assets/js/42.aceb4638.js"><link rel="prefetch" href="/assets/js/44.a36b0e38.js"><link rel="prefetch" href="/assets/js/45.665f52fc.js"><link rel="prefetch" href="/assets/js/46.17b57ec8.js"><link rel="prefetch" href="/assets/js/47.e4569c0c.js"><link rel="prefetch" href="/assets/js/48.4074261b.js"><link rel="prefetch" href="/assets/js/49.197a6964.js"><link rel="prefetch" href="/assets/js/5.597b3655.js"><link rel="prefetch" href="/assets/js/50.c801b6ae.js"><link rel="prefetch" href="/assets/js/51.35646080.js"><link rel="prefetch" href="/assets/js/52.e82c65f0.js"><link rel="prefetch" href="/assets/js/53.c109e4d5.js"><link rel="prefetch" href="/assets/js/54.3035af8a.js"><link rel="prefetch" href="/assets/js/55.91e1388b.js"><link rel="prefetch" href="/assets/js/56.c93e7478.js"><link rel="prefetch" href="/assets/js/57.ffdc83c9.js"><link rel="prefetch" href="/assets/js/58.595f5b98.js"><link rel="prefetch" href="/assets/js/59.331ef14e.js"><link rel="prefetch" href="/assets/js/6.716bb8d3.js"><link rel="prefetch" href="/assets/js/60.6e55b331.js"><link rel="prefetch" href="/assets/js/61.2ca2a15a.js"><link rel="prefetch" href="/assets/js/62.17babb22.js"><link rel="prefetch" href="/assets/js/63.cf82a947.js"><link rel="prefetch" href="/assets/js/64.6a28735c.js"><link rel="prefetch" href="/assets/js/65.3e724f2f.js"><link rel="prefetch" href="/assets/js/66.f690f509.js"><link rel="prefetch" href="/assets/js/67.37b85e7a.js"><link rel="prefetch" href="/assets/js/68.748f1ddb.js"><link rel="prefetch" href="/assets/js/69.f3c41a83.js"><link rel="prefetch" href="/assets/js/7.36f0e6f9.js"><link rel="prefetch" href="/assets/js/70.4dc5bcae.js"><link rel="prefetch" href="/assets/js/71.c810647f.js"><link rel="prefetch" href="/assets/js/72.1e35770c.js"><link rel="prefetch" href="/assets/js/73.34873287.js"><link rel="prefetch" href="/assets/js/74.9ccaf182.js"><link rel="prefetch" href="/assets/js/75.783c04d5.js"><link rel="prefetch" href="/assets/js/76.1eb4fa14.js"><link rel="prefetch" href="/assets/js/77.bdf0d4f5.js"><link rel="prefetch" href="/assets/js/78.e3444d02.js"><link rel="prefetch" href="/assets/js/79.706d25d2.js"><link rel="prefetch" href="/assets/js/8.5f91c910.js"><link rel="prefetch" href="/assets/js/80.23a5de24.js"><link rel="prefetch" href="/assets/js/81.87621ea0.js"><link rel="prefetch" href="/assets/js/82.284dec9d.js"><link rel="prefetch" href="/assets/js/83.322dcc7b.js"><link rel="prefetch" href="/assets/js/84.25e65999.js"><link rel="prefetch" href="/assets/js/85.5feae19a.js"><link rel="prefetch" href="/assets/js/86.d7411053.js"><link rel="prefetch" href="/assets/js/87.50847d75.js"><link rel="prefetch" href="/assets/js/88.dc175b95.js"><link rel="prefetch" href="/assets/js/89.71cddd92.js"><link rel="prefetch" href="/assets/js/9.4060c407.js"><link rel="prefetch" href="/assets/js/90.4fe2d7ec.js"><link rel="prefetch" href="/assets/js/91.49b97bf1.js"><link rel="prefetch" href="/assets/js/92.e692b96a.js"><link rel="prefetch" href="/assets/js/93.b8d3364a.js"><link rel="prefetch" href="/assets/js/94.6249ee76.js"><link rel="prefetch" href="/assets/js/95.bf182597.js"><link rel="prefetch" href="/assets/js/96.59147a46.js"><link rel="prefetch" href="/assets/js/97.527eda66.js"><link rel="prefetch" href="/assets/js/98.adceb7e2.js"><link rel="prefetch" href="/assets/js/99.73ef9405.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5dc1cf24.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Aftersoil-wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/doc.html" class="nav-link">
  Documents
</a></div><div class="nav-item"><a href="/basics/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://github.com/Aftersoil/Aftersoil-wiki" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/node/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/frontend/node/" class="nav-link">
   简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/doc.html" class="nav-link">
  Documents
</a></div><div class="nav-item"><a href="/basics/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://github.com/Aftersoil/Aftersoil-wiki" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/node/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/frontend/node/" class="nav-link">
   简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/frontend/node/" aria-current="page" class="active sidebar-link">Node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/node/#node-js特点" class="sidebar-link">Node.js特点</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#js-与-nodejs区别" class="sidebar-link">JS 与 nodeJs区别</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#nodejs执行方式" class="sidebar-link">NodeJs执行方式</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#buffer-缓冲区" class="sidebar-link">Buffer 缓冲区</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#模块" class="sidebar-link">模块</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#fs模块" class="sidebar-link">fs模块</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#创建web服务器-2" class="sidebar-link">创建web服务器</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#路由" class="sidebar-link">路由</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#路由器" class="sidebar-link">路由器</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#路由器中间件" class="sidebar-link">路由器中间件</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#应用级中间件" class="sidebar-link">应用级中间件</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#内置中间件" class="sidebar-link">内置中间件</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#第三方中间件" class="sidebar-link">第三方中间件</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#test-3" class="sidebar-link">Test</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#获取数据的方式" class="sidebar-link">获取数据的方式</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#执行sql语句" class="sidebar-link">执行sql语句</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#登录查询" class="sidebar-link">登录查询</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#防止攻击" class="sidebar-link">防止攻击</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#demo01" class="sidebar-link">Demo01</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#demo02" class="sidebar-link">Demo02</a></li><li class="sidebar-sub-header"><a href="/frontend/node/#项目文件目录-第二种写法" class="sidebar-link">项目文件目录  （第二种写法）</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node"><a href="#node" class="header-anchor">#</a> Node</h1> <h1 id="es6"><a href="#es6" class="header-anchor">#</a> ES6</h1> <p>ECMAScript<br>
(1) 块级作用域</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>使用<span class="token keyword">let</span>关键字声明变量 阻止变量提升 添加到块级作用域中 成为局部变量
<span class="token keyword">let</span>不允许重复赋值

块级作用域<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">if</span><span class="token punctuation">,</span><span class="token keyword">else</span><span class="token punctuation">,</span><span class="token keyword">while</span><span class="token punctuation">,</span><span class="token keyword">for</span><span class="token operator">...</span>
</code></pre></div><p>(2) 参数增强</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>给参数设置默认值
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>(3) 箭头函数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>回调函数另一种写法 不等价于匿名函数

<span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> a<span class="token operator">-</span>b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

只有一行代码 而且是<span class="token keyword">return</span>的形式 
可以省略为 <span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>a<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>(4)模板字符串</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">在模板字符串之间放任何形式的字符 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JS</span>表达式<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
</code></pre></div><h1 id="nodejs"><a href="#nodejs" class="header-anchor">#</a> NodeJs</h1> <p>服务器端  Ryan Dahl开发<br>
Goole V8引擎Js运行环境</p> <h2 id="node-js特点"><a href="#node-js特点" class="header-anchor">#</a> Node.js特点</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>简单避免过度设计
单线程逻辑处理   
非阻塞的一部<span class="token constant">I</span><span class="token operator">/</span><span class="token constant">O</span>处理  <span class="token constant">IO</span>输入输出   比<span class="token constant">JAVA</span> <span class="token constant">PHP</span> 快很多
事件驱动编程		
无锁机制 不会产生死锁	
支持数百万个并发连接  同时在线访问量数万个访问量 比Java <span class="token constant">PHP</span> 多几万倍    

<span class="token number">1</span> 硬件方面     
<span class="token number">2</span> 服务器集群 多买几台服务器
</code></pre></div><h2 id="js-与-nodejs区别"><a href="#js-与-nodejs区别" class="header-anchor">#</a> JS 与 nodeJs区别</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1</span><span class="token operator">-</span> Js 运行在浏览器端 存在多种浏览器解释器 容易产生兼容性问题
  
	NodeJs运行在服务器端 只有<span class="token constant">V8</span>引擎一种解释器 不存在兼容性问题
  
<span class="token number">2</span><span class="token operator">-</span> 两者都有内置对象<span class="token punctuation">,</span>自定义对象  <span class="token function">宿主对象</span><span class="token punctuation">(</span>不相同<span class="token punctuation">)</span>

<span class="token number">3</span> <span class="token constant">JS</span>浏览器端的交互效果 NodeJs用于服务器端操作 例如创建web服务器<span class="token punctuation">,</span>操作数据库，操作数据库  文件操作
</code></pre></div><h2 id="nodejs执行方式"><a href="#nodejs执行方式" class="header-anchor">#</a> NodeJs执行方式</h2> <div class="language- extra-class"><pre><code>脚本模式  node c:/xampp/...01.js  回车

交互模式  node  回车  进入交互模式  

两次Ctrl+c  或者  .exit

每次只有一个工作  单线程  多个
node默认每次只有一个   
</code></pre></div><h3 id="node-js-适用场景"><a href="#node-js-适用场景" class="header-anchor">#</a> Node.js 适用场景</h3> <div class="language- extra-class"><pre><code>基于社交网络大规模web应用(属于I/O密集型)
</code></pre></div><p>Node.js 适合搭建编译器IO操作为主  响应速度快 易于扩展网络应用例如</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">-</span>命令行工具
<span class="token operator">-</span>带有<span class="token constant">GUI</span>界面本地应用程序
<span class="token operator">-</span>交互式终端程序
<span class="token operator">-</span>单元测试工具
<span class="token operator">-</span>基于社交网络大规模Web应用  【重】 
<span class="token operator">-</span>Web Scoket服务器
<span class="token operator">-</span><span class="token constant">TCP</span> <span class="token operator">/</span> <span class="token constant">UDP</span>套接字程序
<span class="token operator">-</span>客户端Javascript编译器

不适合
NodeJs不适合<span class="token constant">CPU</span>密集型应用 例如
<span class="token operator">-</span>深层次的嵌套和递归
<span class="token operator">-</span>复杂加密和解密算法
<span class="token operator">-</span>高可靠性运算
<span class="token operator">-</span>严格内存管理
<span class="token operator">-</span>数据挖掘和数据分析
NodeJS只占用<span class="token constant">CPU</span> <span class="token number">1</span>核
</code></pre></div><h1 id="全局对象"><a href="#全局对象" class="header-anchor">#</a> 全局对象</h1> <p>(1)  进程对象</p> <div class="language- extra-class"><pre><code>global/process/console/Buffe
</code></pre></div><p>(2) process对象</p> <div class="language- extra-class"><pre><code>进程  执行程序的时候   操作系统分配的内存空间
process.arch  查看当前CPU架构
process.platform 查看当前操作系统
process.env  查看环境变量
process.version node版本号
process.pid 查看当前进程的编号
process.kill() 进程编号
</code></pre></div><p>(3) 打印</p> <div class="language- extra-class"><pre><code>console.log/info
/warn
/error
/time   计时
/timeEnd

console.time('for')

  需要计时的程序体...

console.timeEnd('for')
</code></pre></div><h2 id="buffer-缓冲区"><a href="#buffer-缓冲区" class="header-anchor">#</a> Buffer 缓冲区</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//创建 Buffer</span>
<span class="token keyword">var</span>  buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">'abcdef'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//第一个参数5个字符</span>

<span class="token comment">//读取 Buffer 转换为字符串</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>butf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// toString()</span>
</code></pre></div><h2 id="模块"><a href="#模块" class="header-anchor">#</a> 模块</h2> <p>NodeJs 下模块分为 自定义模块 核心模块 第三方模块</p> <p>自定义模块</p> <p>​	每个文件都是一个模块</p> <p>​	NodeJs自动为每个文件添加了构造函数 所有的代码被构造函数所包含</p> <p>功能体 文件(模块)封装</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span>require<span class="token punctuation">,</span>module<span class="token punctuation">,</span>__filename<span class="token punctuation">,</span>__dirname</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  require<span class="token operator">:</span> 引入目录形式的模块 路径开头
  module<span class="token operator">:</span> 当前模块
  module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>a<span class="token operator">=</span><span class="token number">1</span>  <span class="token comment">//导出内容 fn=fn </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>模块系统</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>require<span class="token operator">:</span> 引入目录形式的模块 路径开头返回一个对象
module<span class="token operator">:</span> 指代当前模块对象
module<span class="token punctuation">.</span>exports<span class="token operator">:</span>当前模块的导出对象
exports<span class="token operator">:</span>指代 module<span class="token punctuation">.</span>exports
__filname<span class="token operator">:</span>当前模块的绝对目录和模块名称
__dirname<span class="token operator">:</span>当前模块的绝对目录
</code></pre></div><p>模块引入</p> <table><thead><tr><th style="text-align:center;">name</th> <th style="text-align:center;">以路径开头的</th> <th style="text-align:center;">不以路径开头的模块</th> <th style="text-align:center;">333</th></tr></thead> <tbody><tr><td style="text-align:center;">文件模块</td> <td style="text-align:center;">require('./circle.js') 常:用引入自定义的模块后缀名.js可以省略</td> <td style="text-align:center;">require('04_2')会到当前目录下的node_modules中寻找04_2目录 如果找不到</td> <td style="text-align:center;">ddd</td></tr> <tr><td style="text-align:center;">目录模块往上一级查找 指定顶级目录常用于引用第三方模块</td> <td style="text-align:center;">require('./02_2')到02_2下寻找 package.json 文件中main属性对应的文件名称找不到会引入index.js</td> <td style="text-align:center;">如果找不到 往上一级查找指定顶级目录 常用于引入第三方模块</td> <td style="text-align:center;">iii</td></tr></tbody></table> <p>​</p> <p>​		
​</p> <h1 id="包和npm"><a href="#包和npm" class="header-anchor">#</a> 包和npm</h1> <p>CommonJs 规范   JS向服务器端发展遵循这个规范</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">包</span><span class="token punctuation">(</span><span class="token keyword">package</span><span class="token punctuation">)</span> 就是一个没目录模块
npm 管理包的工具
</code></pre></div><p>第三方包</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm 包管理工具      npm   <span class="token operator">-</span>v  
查看版本
express 包 NodeJS <span class="token number">30</span>多万

npmJs
mysql  npm install mysql
</code></pre></div><div class="language- extra-class"><pre><code>cd 切换目录
下载 cd    目录拷贝
当前目录Shift+ 单机右键 powershell窗口
</code></pre></div><h1 id="npm-安装-下载"><a href="#npm-安装-下载" class="header-anchor">#</a> npm 安装(下载)</h1> <div class="language- extra-class"><pre><code>npm install 包名称  回车
自动安装到所在目录下的 node_modules
</code></pre></div><p>​    npm  init  -y
​    初始化一个package.json文件用于记录安装的包相关信息
​    用于记录安装包
​</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> npm install 回车
 自动安装<span class="token keyword">package</span><span class="token punctuation">.</span>json 中记录包名称以及版本号
</code></pre></div><h1 id="querystring-模块"><a href="#querystring-模块" class="header-anchor">#</a> querystring  模块</h1> <div class="language-javascript extra-class"><pre class="language-javascript"><code>查询字符串 浏览器向服务器发送请求 传递数据一种形式

<span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span> 引入模块

<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token operator">?</span>keyword<span class="token operator">=</span>手机<span class="token operator">&amp;</span>enc<span class="token operator">=</span>utf<span class="token operator">-</span><span class="token number">8</span>  <span class="token operator">?</span> 后查询数据 <span class="token operator">&amp;</span> 多个

<span class="token keyword">let</span> obj <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> 将查询字符串解析为对象

<span class="token keyword">let</span> str1 <span class="token operator">=</span>  querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">//将对象格式化查询字符串  %E6%89%12%93&amp;eb=utf8</span>

</code></pre></div><p>parse() 将查询字符串解析为对象</p> <p>stringfiy() 将对象格式化为查询字符串</p> <p>​</p> <h1 id="url模块-处理解析url"><a href="#url模块-处理解析url" class="header-anchor">#</a> url模块(处理解析url)</h1> <p>https://www.jd.com :80/list.html?lid=5 //请求文件信息?编号详情</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//引入url模块</span>
 <span class="token keyword">let</span> str <span class="token operator">=</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>jd<span class="token punctuation">.</span>com<span class="token operator">:</span><span class="token number">80</span><span class="token operator">/</span>list<span class="token punctuation">.</span>html<span class="token operator">?</span>lid<span class="token operator">=</span><span class="token number">5</span> <span class="token comment">//请求文件信息?编号详情 </span>

 <span class="token keyword">var</span> obj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> 将<span class="token constant">URL</span>解析为对象
 
 <span class="token keyword">let</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
     protocol<span class="token operator">:</span><span class="token string">'https'</span><span class="token punctuation">,</span>
     hostname<span class="token operator">:</span><span class="token string">'www.taobao.com'</span><span class="token punctuation">,</span>
     port<span class="token operator">:</span><span class="token string">'8080'</span><span class="token punctuation">,</span>
     pathname<span class="token operator">:</span><span class="token string">'list.html'</span><span class="token punctuation">,</span>
     query<span class="token operator">:</span><span class="token string">'lid=5&amp;pname=dell'</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//格式化为Url</span>
 <span class="token keyword">let</span> obj2 <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
 Url <span class="token punctuation">{</span>
  protocol<span class="token operator">:</span> <span class="token string">'http:'</span><span class="token punctuation">,</span>
  slashes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  auth<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  host<span class="token operator">:</span> <span class="token string">'www.tmooc.cn:80'</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token string">'80'</span><span class="token punctuation">,</span>
  hostname<span class="token operator">:</span> <span class="token string">'www.tmooc.cn'</span><span class="token punctuation">,</span>
  hash<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  search<span class="token operator">:</span> <span class="token string">'?lid=5'</span><span class="token punctuation">,</span>
  query<span class="token operator">:</span> <span class="token string">'lid=5'</span><span class="token punctuation">,</span>
  pathname<span class="token operator">:</span> <span class="token string">'/detail.html'</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">'/detail.html?lid=5'</span><span class="token punctuation">,</span>
  href<span class="token operator">:</span> <span class="token string">'https://www.jd.com.com:80/detail.html?lid=5'</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="参数解析"><a href="#参数解析" class="header-anchor">#</a> 参数解析</h4> <p>protocol  协议
hostname 主机名  域名/ip地址
port   端口号
pathname  请求文件路径名称
query  查询字符串 对应的是对象
format() 格式化URl</p> <div class="language- extra-class"><pre><code>https: 加密协议  不会被拦截   收费
</code></pre></div><h1 id="全局函数"><a href="#全局函数" class="header-anchor">#</a> 全局函数</h1> <p>parseInt/parseFloat/isNaN/isFinite/eval..</p> <p>global.setTimeout</p> <p>全局函数都可以通过global调用
(1) 一次性定时器</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    开启
    <span class="token keyword">var</span> timer <span class="token operator">=</span> global<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    间隔时间到 执行一次回调函数 单位是毫秒  <span class="token comment">//广告</span>
    清除
   	global<span class="token punctuation">.</span><span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
</code></pre></div><p>(2)周期性定时器</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> timer<span class="token operator">=</span> global<span class="token punctuation">.</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>
    每隔一段是时间执行一次回调函数  <span class="token comment">//广告</span>
global<span class="token punctuation">.</span><span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
</code></pre></div><p>只可以运行在nodejs 端</p> <p>(3)立即执行定时器</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  回调函数先执行事件队列
  <span class="token keyword">var</span> timer<span class="token operator">=</span>global<span class="token punctuation">.</span><span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//先</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//后      </span>
  global<span class="token punctuation">.</span><span class="token function">clearImmediate</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

  事件队列的开头执行
</code></pre></div><p>(4)立即执行</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
在主程序的后边执行
</code></pre></div><h3 id="单线程"><a href="#单线程" class="header-anchor">#</a> 单线程</h3> <p>几核CPU 也就有几个线程</p> <p>nodeJs 只有单线程    回调函数</p> <p>主程序内容先执行 后执行事件队列内容</p> <p>//耗时操作 都放到事件队列中</p> <p>事件队列 回调函数 先放到事件队列</p> <h1 id="fs模块-文件操作"><a href="#fs模块-文件操作" class="header-anchor">#</a> fs模块(文件操作)</h1> <p>文件包含文件和目录  统称文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  使用模块先引入
  <span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  cd 必须先进入当前文件目录 
  
  查看文件状态
  fs<span class="token punctuation">.</span><span class="token function">stats</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>callback<span class="token punctuation">)</span> 
  
  fs<span class="token punctuation">.</span><span class="token function">stats</span><span class="token punctuation">(</span><span class="token string">'01.js'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>stats</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>  path 文件路径
  callback 回调函数 用于获取
    err  可能产生的错误信息 
    stats 具体的文件状态
</code></pre></div><p>执行结果</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Stats <span class="token punctuation">{</span>
  dev<span class="token operator">:</span> <span class="token number">135415406</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token number">33206</span><span class="token punctuation">,</span>
  nlink<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  uid<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  gid<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  rdev<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  blksize<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  ino<span class="token operator">:</span> <span class="token number">281474977589076</span><span class="token punctuation">,</span>
  size<span class="token operator">:</span> <span class="token number">896</span><span class="token punctuation">,</span> <span class="token comment">//大小</span>
  blocks<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  atimeMs<span class="token operator">:</span> <span class="token number">1585858794493.5378</span><span class="token punctuation">,</span> 
  mtimeMs<span class="token operator">:</span> <span class="token number">1573198767472.8367</span><span class="token punctuation">,</span>
  ctimeMs<span class="token operator">:</span> <span class="token number">1585761878754.9795</span><span class="token punctuation">,</span>
  birthtimeMs<span class="token operator">:</span> <span class="token number">1585761878753.9734</span><span class="token punctuation">,</span>  <span class="token comment">//出生时间</span>
  atime<span class="token operator">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">02</span>T20<span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">54.494</span>Z<span class="token punctuation">,</span>
  mtime<span class="token operator">:</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">08</span>T07<span class="token operator">:</span><span class="token number">39</span><span class="token operator">:</span><span class="token number">27.473</span>Z<span class="token punctuation">,</span>
  ctime<span class="token operator">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">01</span>T17<span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">38.755</span>Z<span class="token punctuation">,</span>
  birthtime<span class="token operator">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">01</span>T17<span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">38.754</span>Z 
<span class="token punctuation">}</span>
</code></pre></div><h1 id="同步-sync-和异步"><a href="#同步-sync-和异步" class="header-anchor">#</a> 同步(sync)和异步</h1> <div class="language- extra-class"><pre><code>同步
等待前边的代码执行完 才执行后边的代码 回阻止后边代码的执行 通过返回值
来获取结果

异步  放在事件队列中操作   
不会阻止后边代码执行 后边的操作可以先执行不必等待前边的操作结束 通过
回调函数来获取结果

API 中 只要参数含有callback 他就是异步的 // 通过回调函数  事件队列中执行
Sync 就是同步的  // 通过返回值获取结果  在主程序种执行
</code></pre></div><h2 id="fs模块"><a href="#fs模块" class="header-anchor">#</a> fs模块</h2> <p>查看文件状态</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">statSync</span><span class="token punctuation">(</span>pach<span class="token punctuation">)</span>
kb 小 <span class="token function">statSync</span><span class="token punctuation">(</span>pach<span class="token punctuation">)</span> 
</code></pre></div><p>创建目录</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
</code></pre></div><p>移除目录</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">rmdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
</code></pre></div><p>读取目录</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token operator">/</span>fs<span class="token punctuation">.</span><span class="token function">reddirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
  callback
    err  可能产生的错误    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> 
  result 读取的结果 格式为数组
</code></pre></div><p>创建文件/写入文件/</p> <p>清空写入</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>data<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>data<span class="token punctuation">)</span>

data 要写入的数据

如果文件不存在 会创建文件并写入数据<span class="token punctuation">;</span>
如果文件已经存在 会清空文件中内容 然后写入数据 

fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文件写入成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>追加写入</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>data<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">appendFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>data<span class="token punctuation">)</span>
如果文件不存在 就会创建文件 然后写入数据
  如果文件已经存在 会再文件的末尾写入数据
  
arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'html5'</span><span class="token punctuation">,</span><span class="token string">'css3'</span><span class="token punctuation">,</span><span class="token string">'canvas'</span><span class="token punctuation">,</span><span class="token string">'svg'</span><span class="token punctuation">,</span><span class="token string">'nodejs'</span><span class="token punctuation">,</span><span class="token string">'mysql'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>练习： 创建数组 每一个元素是一个课程名称, 遍历数组分别获取元素,
将数据使用同步方法写入到文件 data.txt</p> <p>读取文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token operator">/</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
  	  callback
	      err
		  data 读取文件 格式为buffer
   
   fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>删除文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
</code></pre></div><p>判断文件是否存在
fs.existsSync('path')</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> 练习 判断data<span class="token punctuation">.</span>txt 是否存在 如果存在 则删除
 
<span class="token keyword">let</span> res <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token operator">==</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">)</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'删除成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">if</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">sxistsSync</span><span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//如果存在进行删除</span>
	fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

 
</code></pre></div><p>​</p> <p>拷贝文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span>dest<span class="token punctuation">,</span>callback<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">copyFileSync</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span>dest<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre></div><h1 id="文件流-内存读取-readstream"><a href="#文件流-内存读取-readstream" class="header-anchor">#</a> 文件流 内存读取  ReadStream</h1> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>文件路径<span class="token punctuation">)</span> 创建可读流

readStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

当有数据流入  自动触发事件
通过回调函数来获取 chunk就是获取的数据流

readStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

当读取结束 自动触发时间
pipe 管道<span class="token punctuation">,</span>可将数据从可读流添加到可写流
</code></pre></div><p>执行代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//引入fs模块</span>

<span class="token keyword">var</span> readStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'02_fs.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.1 创建可读流</span>


readStream<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.2 设置编码utf8</span>
 
readStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//1.3 获取数据流 </span>
  	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

readStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 1.4 事件：监听是否读取结束</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取结束'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="服务器端的拷贝"><a href="#服务器端的拷贝" class="header-anchor">#</a> 服务器端的拷贝</h5> <p>使用可读流和可写流 拷贝文件</p> <p>创建可读流</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> readStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'02_fs.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>创建可写流</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> writeStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'fork.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>读取的流通过管道放入到写入流</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>readStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="http协议-超文本传输协议"><a href="#http协议-超文本传输协议" class="header-anchor">#</a> http协议 超文本传输协议</h1> <p>浏览器和Web服务器的通讯协议</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Network
Response 响应  服务器给浏览器
Request 请求   浏览器给服务器
</code></pre></div><p>(1) 通用头信息</p> <div class="language-tex extra-class"><pre class="language-tex"><code>Request URL: 请求的URL 对应的浏览器地址栏 向服务器获取哪些内容

Request Method:GET   请求的方法 获取内容的方法

get 获取/post 传递
  
StatusCode: 200 OK;  响应的状态码
1**:正在响应  3**: 响应重定向  跳转另一个URL
2**:成功响应  4**: 客户端请求错误
5**:服务器端错误

  Remote Address: 请求服务器的IP地址及端口号
</code></pre></div><p>(2) 响应头信息</p> <div class="language- extra-class"><pre><code>连接方式
Connection: keep-alive  持久连接
Content-Encoding:gzip   压缩形式 
Content-Type:text/html  响应的文件类型
Location: 跳转的URL 常配合状态码 3**使用
</code></pre></div><p>(3) 请求头信息</p> <div class="language- extra-class"><pre><code>Accept 浏览器接受的文件类型有哪些
Accept-Encoding:接收的压缩形式有哪些
User-Agent: 客户端使用的浏览器版本
</code></pre></div><p>(4) 请求主体</p> <p>可有可无  浏览器响服务器端发送请求传递的数据</p> <h1 id="http模块"><a href="#http模块" class="header-anchor">#</a> http模块</h1> <p>模拟浏览器向web服务器发请求 还可以创建web服务器</p> <p>http模块</p> <p>​	模拟浏览器向web服务器发送请求 还可以创建 web服务器</p> <p>(1)模拟浏览器</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>发送请求
  url 请求的<span class="token constant">URL</span>
  callback 回调函数 获取服务器端的响应
    res 响应的对象
    res<span class="token punctuation">.</span>statusCode 获取相应的状态码
    res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    事件<span class="token operator">:</span>监听服务器端是否有数据传输过来
    chunk 就是传输数据 格式为buffer

</code></pre></div><p>执行代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>引入http
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://www.tmooc.cn'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//res: 相应的对象</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 获取相应的内容  数据流</span>
	<span class="token comment">// 事件 监听是否有数据流</span>
	res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

参数解析
    向web服务器发送请求  <span class="token keyword">get</span> 获取
    参数<span class="token number">1</span> 请求的<span class="token constant">URL</span>
    参数<span class="token number">2</span> 获取响应
</code></pre></div><h3 id="创建web服务器"><a href="#创建web服务器" class="header-anchor">#</a> 创建web服务器</h3> <div class="language- extra-class"><pre><code>const http = require('http'); //引入http模块


创建web服务
var app=http.createServer();

设置监听的端口
app.listen(8080);

监听浏览器请求
app.on('request',function(req,res){
  获取请求对象
  req 请求的对象
    req.url 请求的url 获取端口号后边的部分
    req.method 请求的方法
    req.headers 请求的头信息 //不重要

  res  响应的对象
    res.write()设置响应的内容
    res.writeHead(状态码,头信息对象)
    
    //重定向跳转
    res.writeHead(302,{
    	Loaction:'http//www.tco.cn'
    })
    
    res.end() 结束并发送响应到浏览器
});
</code></pre></div><h3 id="test"><a href="#test" class="header-anchor">#</a> Test</h3> <p>创建web服务器 监听端口 8080 接收浏览器的请求, 根据请求作出不同的相应</p> <p>http://127.0.0.1:8080/reg</p> <p>/login 相应内容 this is Login page</p> <p>/reg  相应内容 this is reg page</p> <p>/study 跳转到 this is study page</p> <h4 id="执行代码"><a href="#执行代码" class="header-anchor">#</a> 执行代码:</h4> <p>执行代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//1.1 引入zilb模块</span>
<span class="token keyword">const</span> zlib<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'zlib '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//引入http模块</span>
<span class="token keyword">const</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建web服务器</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//监听端口号</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span>

<span class="token comment">//接收浏览器请求</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//根据请求作出相应</span>
    <span class="token comment">// res.write('this is Homepage')</span>
    <span class="token comment">// res.end()</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token operator">==</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'this is  loginPage'</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token operator">==</span><span class="token string">'/reg'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'this is  regPage'</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token operator">==</span><span class="token string">'/study'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
           Location<span class="token operator">:</span><span class="token string">'http://www.tmooc.cn'</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//如果请求url是/index相应 tmooc.html</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token operator">==</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          
        <span class="token comment">/*   方法  1  
 
        //异步读取文件
        var data = fs.readFileSync('tmooc.html');
        //响应内容
        res.write(data.toString());
        res.end();
        //解决 响应内容乱码
        */</span>

		<span class="token comment">// 方法2 数据流   压缩技术  </span>
        <span class="token comment">//设置响应头信息 告诉浏览器 响应的内容按照网页去解析</span>
        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
            <span class="token string">'Content-Type'</span><span class="token operator">:</span><span class="token string">'text/html'</span><span class="token punctuation">,</span>
            <span class="token comment">// 设置压缩类型</span>
            <span class="token string">'Content-Encoding'</span><span class="token operator">:</span><span class="token string">'gzip'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//使用压缩形式</span>
        <span class="token comment">//2.1创建gzip压缩</span>
        <span class="token keyword">var</span> gzip<span class="token operator">=</span>zlib<span class="token punctuation">.</span><span class="token function">createGzip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//4 使用读取流读取文件并响应到浏览器</span>
        fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'tmooc.html'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gzip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="响应压缩-提高服务器性能"><a href="#响应压缩-提高服务器性能" class="header-anchor">#</a> 响应压缩 提高服务器性能</h4> <h5 id="_1-1-引入zilb模块"><a href="#_1-1-引入zilb模块" class="header-anchor">#</a> 1.1 引入zilb模块</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">const</span> zlib<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'zlib '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_1-2-设置压缩内容形式"><a href="#_1-2-设置压缩内容形式" class="header-anchor">#</a> 1.2 设置压缩内容形式</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">'Conten-Encoding'</span><span class="token operator">:</span><span class="token string">'gzip'</span>   <span class="token comment">//注意是在相应头中定义</span>
</code></pre></div><h5 id="_1-3-创建压缩"><a href="#_1-3-创建压缩" class="header-anchor">#</a> 1.3 创建压缩</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> gzip <span class="token operator">=</span> zlib<span class="token punctuation">.</span><span class="token function">createGzip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="使用读取流读取文件并响应到浏览器"><a href="#使用读取流读取文件并响应到浏览器" class="header-anchor">#</a> 使用读取流读取文件并响应到浏览器</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'tmooc.html'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gzip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="express"><a href="#express" class="header-anchor">#</a> Express</h1> <p>基于nodeJs平台,快速,开放,极简的web开发框架</p> <p>www.expressjs.com.cn 中文官网</p> <p>安装</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm install express
</code></pre></div><h2 id="创建web服务器-2"><a href="#创建web服务器-2" class="header-anchor">#</a> 创建web服务器</h2> <p>引入express 模块</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>创建web服务器</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>   <span class="token keyword">var</span> app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>监听端口</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>根据请求作出响应</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'这是登陆的页面'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h2> <p>浏览器向 web 服务发出请求,web服务器根据请求的url和请求的方法作出响应
三要素: 请求的url 请求的方法 响应(回调函数)</p> <p>res  响应对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 设置并发送相应的内容  路由中只能响应一次
<span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 响应文件<span class="token punctuation">,</span>要求使用绝对路径  __dirname<span class="token operator">+</span><span class="token string">'/tmooc.html'</span>
<span class="token function">redirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 响应的重定向 跳转到另一个url
</code></pre></div><p>req 请求的对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>method 请求的方法
url 请求的url
headers  请求的头信息
query   获取请求的查询字符串形式的数据 格式为对象
params  获取路由传递的数据 设置路由中接收数据的名称
</code></pre></div><h3 id="路由传参"><a href="#路由传参" class="header-anchor">#</a> 路由传参</h3> <h4 id="get"><a href="#get" class="header-anchor">#</a> Get</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//路由  请求方法 get 请求url:/shoping 响应并发送</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/shopping/:price'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// 获取路由的数据</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'这是购物车'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin/:uname/:upwd'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// 获取路由数据字符串</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'欢迎用户:'</span><span class="token operator">+</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>uname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="post"><a href="#post" class="header-anchor">#</a> Post</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/mylogin'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'登录成功'</span><span class="token punctuation">)</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">mydata</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      格式化查询为字符串<span class="token punctuation">,</span>需要解析为对象
      把查询字符串转对象
		<span class="token keyword">var</span> str <span class="token operator">=</span> mydata<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      	mydata<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


</code></pre></div><p><em>//练习 使用express 创建web服务器 创建路由 请求方post请求url:/login,响应一个文件login.html到浏览器端。</em></p> <p>html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>请登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- for 表单标签 用于提交到服务器
	method: 设置请求的方法  post/get
	action: 设置请求的url
	name: 用于接收表单输入的数据
	--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/myloging<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	用户:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uname<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
	密码:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
创建web服务器
<span class="token keyword">var</span> app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
获取请求
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/myloging'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//获取post请求数据</span>
	<span class="token comment">//事件:</span>
	req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">mydata</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//buffer数据-&gt; 查询字符串</span>
		<span class="token comment">//console.log(mydata.toString());</span>
		
        <span class="token comment">//把查询字符串转对象</span>
		<span class="token keyword">var</span> str <span class="token operator">=</span> mydata<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
        
		<span class="token keyword">var</span> obj <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


</code></pre></div><h4 id="get-和-post-请求"><a href="#get-和-post-请求" class="header-anchor">#</a> get 和 post 请求</h4> <p>在浏览器 地址栏直接输入url 默认是get请求</p> <p>传递数据使用查询字符串  浏览记录可能被浏览器缓存</p> <p>post请求需要使用表单提交来完成(现阶段)</p> <h2 id="路由器"><a href="#路由器" class="header-anchor">#</a> 路由器</h2> <p>路由在使用的过程中 不同模块下的路由可能出现相同url;
把同一个模块下的路由放到特定的路由器</p> <p>1 创建路由器</p> <p>路由器是express下的一个功能</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建路由器对象</span>

<span class="token keyword">var</span> router<span class="token operator">=</span>express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//路由器添加路由</span>

<span class="token comment">//get  /list</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'这是用户列表'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
导出路由对象
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>router<span class="token punctuation">;</span>
</code></pre></div><p>2  在web服务器中使用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//引入路由器模块   </span>

<span class="token comment">// 自定义模块 必须加./</span>
<span class="token keyword">const</span> userRouter<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./user.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建web服务器</span>
<span class="token keyword">var</span> app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//监听端口 </span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


挂载路由
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span>userRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 参数 1: 挂载的url</span>
<span class="token comment">// 参数 2: 要挂载的路由器</span>

</code></pre></div><h3 id="test-2"><a href="#test-2" class="header-anchor">#</a> Test</h3> <p>创建路由,请求的方法：get 请求url:/study,响应内容并发送
浏览器传递数据
http://127.0.0.1:8080/shopping/4999</p> <p>1 创建路由器</p> <p>product.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//引入服务器</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token comment">// 创建路由对象</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//添加路由</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'这是商品列表'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/update'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'修改商品列表'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/datele'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'删除商品列表'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 导出路由对象</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre></div><p>2 创建web服务器</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> productRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./product.js'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//使用路由器</span>
<span class="token comment">// 路由级中间件使用</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/product'</span><span class="token punctuation">,</span>productRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h1> <p>为主要的业务逻辑服务  接收到请求 以及作出响应
应用级中间件 路由级中间件  内置中间件 第三方中间件
错误处理中间件</p> <h2 id="路由器中间件"><a href="#路由器中间件" class="header-anchor">#</a> 路由器中间件</h2> <div class="language- extra-class"><pre><code>  app.use('/user',userRouter)
</code></pre></div><h2 id="应用级中间件"><a href="#应用级中间件" class="header-anchor">#</a> 应用级中间件</h2> <p>也称为自定义中间件 是一个函数(回调函数);</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/reg'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  拦截url为<span class="token operator">/</span>reg的路由
  next是一个函数 表示执行下一个中间件或者路由
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="内置中间件"><a href="#内置中间件" class="header-anchor">#</a> 内置中间件</h2> <p>把所有的静态资源托管到某个目录 如果浏览器请求静态资源 自动到该目录下寻找 无需创建路由</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'托管的目录'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>​	// 把所有的静态资源(htmll,css,js 图片等文件)托管到某一个目录 public 下
​	// 当浏览器请求静态资源,会自动到public目录下寻找,不需要再创建单独的路由响应文件</p> <div class="language- extra-class"><pre class="language-text"><code>app.use( express.static('public'));
app.use( express.static('files'));
</code></pre></div><p>练习把静态资源托管到file目录</p> <div class="language- extra-class"><pre class="language-text"><code>app.use(express.json());
</code></pre></div><p>用于处理请求体中json数据</p> <h2 id="第三方中间件"><a href="#第三方中间件" class="header-anchor">#</a> 第三方中间件</h2> <p>body-parser中间件使用</p> <ol><li>下载安装</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>	npm instass body<span class="token operator">-</span>parser<span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>引入中间件模块</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> bodyParser<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>使用中间件</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>    将post请求数据解析为对象
    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParse<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
      不使用第三方 的qs模块解析查询字符串为对象 而是使用querystring模块
      extended<span class="token operator">:</span><span class="token boolean">false</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li>在post请求的路由中 req.body 返回对象</li></ol> <h2 id="test-3"><a href="#test-3" class="header-anchor">#</a> Test</h2> <p><em>创建web服务器 托管静态资源到public目录下 浏览器向服务器请求login.html, 请求方法 post 请求url:/mylogin</em></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">//引入 boody-parser中间件</span>
<span class="token keyword">const</span> bodyParser<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 托管静态资源到public 目录</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 使用body-parser中间件</span>

<span class="token comment">// 将post请求的数据解析为对象</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	extended<span class="token operator">:</span><span class="token boolean">false</span>   <span class="token comment">// 不使用第三方qs模块,而是使用核心模块querystring来解析查询字符串为对象</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//根据表单的请求 创建对应的路由</span>
 app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/mylogin'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> 
	<span class="token comment">// 获取post 请求的数据  s使用body-parser中间件  不需要解析字符串</span>
	<span class="token comment">/*
	req.on('data',function(mydata){
		//console.log(mydata.toStrong)
		var obj = querystring.parse(mydata.toString());
		console.log(obj);
	});
	*/</span>
	
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>

	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'登录成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="获取数据的方式"><a href="#获取数据的方式" class="header-anchor">#</a> 获取数据的方式</h2> <table><thead><tr><th>名称</th> <th>形式</th> <th>获取(路由)</th></tr></thead> <tbody><tr><td>get</td> <td>?lid=1&amp;pname=dell</td> <td>req.query</td></tr> <tr><td>路由传递</td> <td>/shopping/4999</td> <td>req.params</td></tr> <tr><td>post</td> <td>无法通过url查看</td> <td>前提需要使用中间件 body-parser</td></tr></tbody></table> <h1 id="mysql模块"><a href="#mysql模块" class="header-anchor">#</a> Mysql模块</h1> <div class="language-javascript extra-class"><pre class="language-javascript"><code>mysql<span class="token punctuation">.</span>exe <span class="token operator">-</span>h127<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token number">.1</span>  <span class="token operator">-</span><span class="token constant">P3306</span> <span class="token operator">-</span>uroot <span class="token operator">-</span>p
</code></pre></div><p>引入mysql模块</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>创建连接对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token keyword">const</span> connection<span class="token operator">=</span>mysql<span class="token punctuation">.</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     host<span class="token operator">:</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
     port<span class="token operator">:</span><span class="token string">'3306'</span><span class="token punctuation">,</span>
     user<span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>
     passworld<span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>
     database<span class="token operator">:</span><span class="token string">'xz'</span>		
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>建立连接</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="执行sql语句"><a href="#执行sql语句" class="header-anchor">#</a> 执行sql语句</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql语句<span class="token punctuation">,</span>calback<span class="token punctuation">)</span>
    err 可能产生的错误
    result SQl语句的执行结果

  执行删除 修改 插入返回对象<span class="token punctuation">,</span>如果返回对象的属性中 affectedRows 大于<span class="token number">0</span> 说明执行成功
  
  执行查询返回数组 
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'DELETE FROM emp WHERE eid=3'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//err 可能产生的错误</span>
	<span class="token comment">//result SQL语句的结果</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>affectedRows 大于0 说明执行成功</p> <h2 id="登录查询"><a href="#登录查询" class="header-anchor">#</a> 登录查询</h2> <p>用户名和密码同时满足的结果 返回一条数据</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> user <span class="token constant">WHERE</span> uname<span class="token operator">=</span><span class="token string">'root'</span> <span class="token constant">AND</span> upwd<span class="token operator">=</span><span class="token string">'123456'</span> or <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//OR 1=1 SQL注入 执行登录成功</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> emp where eid<span class="token operator">=</span><span class="token number">5</span> or <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>  
<span class="token comment">//测试 删除表中所有数据 	</span>
</code></pre></div><h2 id="防止攻击"><a href="#防止攻击" class="header-anchor">#</a> 防止攻击</h2> <p>SQl注入</p> <p>? 占位符,过滤传入的值 防止被sql注入</p> <p>表中插入数据</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'INSERT INTO emp VALUES(?,?,?,?,?,?)'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'abcd'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'1997-9-2'</span><span class="token punctuation">,</span><span class="token number">800</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>mysql 内部脚本化</p> <h4 id="直接将对象插入数据库"><a href="#直接将对象插入数据库" class="header-anchor">#</a> 直接将对象插入数据库</h4> <p>mysql模块  封装后的 SET</p> <p>不是标准的sql语句</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">var</span> emp<span class="token operator">=</span><span class="token punctuation">{</span>
    eid<span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span>
    ename<span class="token operator">:</span><span class="token string">'ccc'</span><span class="token punctuation">,</span>
    birthday<span class="token operator">:</span><span class="token string">'1995-8-3'</span><span class="token punctuation">,</span>
    sex<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
    salary<span class="token operator">:</span><span class="token number">9000</span><span class="token punctuation">,</span>
    deptId<span class="token operator">:</span><span class="token number">20</span>
  <span class="token punctuation">}</span>

  connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'INSERT INTO emp SET ?'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>emp<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
 关闭连接
 connection<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>关闭连接</p> <p>长时间开启影响服务器性能</p> <p>connection.end();</p> <p>使用连接池</p> <div class="language-js extra-class"><pre class="language-js"><code>  connectionLimit 用于设置连接池的大小 默认<span class="token number">15</span>个

  <span class="token keyword">var</span> pool<span class="token operator">=</span>mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行SQL语句</p> <div class="language-js extra-class"><pre class="language-js"><code>  pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql语句<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre></div><p>执行代码</p> <h1 id="使用连接池连接"><a href="#使用连接池连接" class="header-anchor">#</a> 使用连接池连接</h1> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> mysql<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>创建连接池对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> pool<span class="token operator">=</span>mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  host<span class="token operator">:</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span><span class="token string">'3306'</span><span class="token punctuation">,</span>
  user<span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>
  database<span class="token operator">:</span><span class="token string">'tedu'</span><span class="token punctuation">,</span>
  connectionLimit<span class="token operator">:</span><span class="token number">20</span> <span class="token comment">// 设置连接池的大小 小型博客</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行SQL语句</p> <div class="language-js extra-class"><pre class="language-js"><code>  pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM emp'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行SQL语句 删除员工表编号为5的数据</p> <div class="language-js extra-class"><pre class="language-js"><code>pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'DELETE FROM emp WHERE eid=?'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="项目sql-语句执行"><a href="#项目sql-语句执行" class="header-anchor">#</a> 项目SQL 语句执行</h1> <h2 id="demo01"><a href="#demo01" class="header-anchor">#</a> Demo01</h2> <p>创建web服务器 (路由器 路由) 托管静态资源到public  创建文件 add.html 点击提交  将数据插入到 tedu 下数据表 dept中</p> <p>get       /add</p> <p>app.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
创建web服务器
<span class="token keyword">var</span>  app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//添加中间件托管</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//连接数据库</span>
<span class="token keyword">var</span> pool<span class="token operator">=</span>mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	host<span class="token operator">:</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
	post<span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
	user<span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>
	password<span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>
	database<span class="token operator">:</span><span class="token string">'tedu'</span><span class="token punctuation">,</span>
	connectionLimit<span class="token operator">:</span><span class="token number">20</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">//根据表单的提交创建对应的路由</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// 如何获取get  // boty 获取post //parmat url // 后的数据</span>
	<span class="token keyword">var</span> obj<span class="token operator">=</span>req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 执行SQL语句 将数据插入到数据库中</span>
	pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'INSERT INTO dept SET ?'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>obj<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//如果插入成功 才响应</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>affectedRows<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'注册成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>public</p> <p>​		&gt; index.html</p> <div class="language-html extra-class"><pre class="language-html"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>get<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/add<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	编号:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>did<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
	名称:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dname<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>server</p> <p>​		&gt; dept.sql</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span>  <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> tedu<span class="token punctuation">;</span>

<span class="token keyword">SET</span> NAMES UTF8<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> tedu <span class="token keyword">CHARSET</span><span class="token operator">=</span>UTF8<span class="token punctuation">;</span>

<span class="token keyword">USE</span> tedu<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dept<span class="token punctuation">(</span>
	did <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	dname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token keyword">CHARSET</span><span class="token operator">=</span>UTF8<span class="token punctuation">;</span>
</code></pre></div><h2 id="demo02"><a href="#demo02" class="header-anchor">#</a> Demo02</h2> <div class="language-js extra-class"><pre class="language-js"><code>node_module	 相关包依赖
<span class="token keyword">public</span>  <span class="token operator">--</span>  静态html
routers <span class="token operator">--</span>  路由逻辑实现
app<span class="token punctuation">.</span>js <span class="token operator">--</span> 服务启动
pool <span class="token operator">--</span> 连接池
</code></pre></div><p>app.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//服务器中引入中间件</span>

<span class="token comment">//引入 body-Parser </span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建web服务器</span>
<span class="token keyword">var</span>  app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//监听端口</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//使用body-parser中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	extended<span class="token operator">:</span><span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token comment">//引入用户路由器</span>
<span class="token keyword">const</span> userRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/user.js'</span><span class="token punctuation">)</span>
<span class="token comment">//引入登录路由器</span>


<span class="token comment">// 静态资源到 目录</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建网页  </span>



<span class="token comment">// 使用路由器 挂载到/user下</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span>userRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>pool 创建连接池</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入mysql </span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建连接池</span>
<span class="token keyword">var</span> pool <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	host<span class="token operator">:</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
	post<span class="token operator">:</span><span class="token string">'3306'</span><span class="token punctuation">,</span>
	user<span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>
	password<span class="token operator">:</span><span class="token string">'root'</span><span class="token punctuation">,</span>
	database<span class="token operator">:</span><span class="token string">'xz'</span><span class="token punctuation">,</span>
	connectionLimit<span class="token operator">:</span><span class="token number">20</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//导出连接池对象</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>pool<span class="token punctuation">;</span>
</code></pre></div><p>routers</p> <p>​		&gt;  user.js  主要逻辑代码实现区域</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//引入连接池模块</span>
<span class="token keyword">const</span> pool <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../pool.js'</span><span class="token punctuation">)</span>


<span class="token comment">//创建路由器</span>
<span class="token keyword">let</span> router<span class="token operator">=</span>express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


路由逻辑代码
<span class="token punctuation">[</span>router<span class="token punctuation">]</span>

<span class="token comment">//导出对象</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>router<span class="token punctuation">;</span>
</code></pre></div><p>注册路由 [router]</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 注册路由</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/reg'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> obj<span class="token operator">=</span>req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//1.2 验证每一项是否为空</span>
	<span class="token comment">// 如果用户名为空</span>
	<span class="token keyword">let</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token number">401</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token operator">:</span> code<span class="token punctuation">,</span>
                msg <span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> Not Null</span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
	<span class="token comment">//1.3 执行sql语句</span>
	pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'INSERT INTO xz_reg SET ?'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>obj<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 如果数据插入成功</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>affectedRows<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code<span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>msg<span class="token operator">:</span><span class="token string">'reg suc'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/reg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>用户注册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
	用户名:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uname<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
	密码:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
	手机:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>phon<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
	邮箱:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>注册<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>登录路由  [router]</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 登录路由</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//查询是否有用户名和密码同时的数据 查看数据库已有的数据</span>
	pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM xz_login WHERE uname=? AND upwd = ?'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>obj<span class="token punctuation">.</span>uname<span class="token punctuation">,</span>obj<span class="token punctuation">.</span>upwd<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>  <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 判断扥登录成功还是失败</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//有元素执行</span>
			res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code<span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>msg<span class="token operator">:</span><span class="token string">'login suc'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//没有元素 失败</span>
			res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code<span class="token operator">:</span><span class="token number">201</span><span class="token punctuation">,</span>msg<span class="token operator">:</span><span class="token string">'uname and upwd error'</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>用户登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/login<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uname<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
	密码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>登录<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>检索用户  [router]</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 检索用户</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/datail'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token comment">//3.1获取数据</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//3.2 验证数据是否为空</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">{</span>
		res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			code<span class="token operator">:</span><span class="token number">401</span><span class="token punctuation">,</span>msg<span class="token operator">:</span><span class="token string">'uid required'</span> 
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//执行sql语句</span>
	pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM xz_reg WHERE uid=?'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>obj<span class="token punctuation">.</span>uid<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
		res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>检索用户<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>get<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/datail<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	编号:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>	<span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>用户修改  [router]</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 用户修改</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/update'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
	<span class="token comment">//数据获取</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
	<span class="token comment">//验证数据为空</span>
	<span class="token comment">// 批量验证  遍历</span>
	<span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> obj <span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		i<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//设置状态码</span>
		<span class="token comment">//如果属性值为空 提示属性名必须</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code<span class="token operator">:</span>i<span class="token punctuation">,</span>msg<span class="token operator">:</span>key<span class="token operator">+</span><span class="token string">' required'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

    
	<span class="token comment">// 取出用户编号</span>
	<span class="token keyword">var</span> uid <span class="token operator">=</span> obj<span class="token punctuation">.</span>uid<span class="token punctuation">;</span>
	<span class="token comment">// 删除对象中的编号属性</span>
	<span class="token keyword">delete</span> obj<span class="token punctuation">.</span>uid 
	pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'UPDATE xz_reg SET ? WHERE uid=?'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>obj<span class="token punctuation">,</span>uid<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
		<span class="token comment">//console.log(result);</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>affectedRows<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>msg<span class="token operator">:</span><span class="token string">'update suc'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code <span class="token operator">:</span> <span class="token number">201</span><span class="token punctuation">,</span>msg<span class="token operator">:</span><span class="token string">'update error'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>用户修改<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/update<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	编号<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
	手机<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>phon<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
	邮箱<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
	姓名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uname<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>用户列表分页  [router]</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 用户列表</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token comment">// 5.1 获取数据</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//res.send('用户列表');	 这里卡了半节课   </span>
	<span class="token comment">//5.2 验证为空 设置默认值</span>
	<span class="token keyword">var</span> count <span class="token operator">=</span> obj<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
	<span class="token keyword">var</span> pno <span class="token operator">=</span> obj<span class="token punctuation">.</span>pno<span class="token punctuation">;</span>
	count <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
	pno <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>pno<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>count<span class="token punctuation">)</span><span class="token punctuation">{</span>
		count<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>pno<span class="token punctuation">)</span><span class="token punctuation">{</span>
		pno<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//console.log(count,pno);</span>
	<span class="token comment">//转整形</span>
	
	<span class="token comment">//计算开始</span>
	<span class="token keyword">var</span> start <span class="token operator">=</span> <span class="token punctuation">(</span>pno<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>count<span class="token punctuation">;</span>
	
	<span class="token comment">//执行sql语句</span>
	pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM xz_reg LIMIT ?,?'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>start<span class="token punctuation">,</span>count<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
		res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>用户列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>get<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/list<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
	大小:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span> 
	页码:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pno<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>删除用户 [router]</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/delete'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token comment">// 获取数据</span>
	<span class="token keyword">var</span> obj<span class="token operator">=</span>req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">{</span>
		res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code<span class="token operator">:</span><span class="token string">'401'</span><span class="token punctuation">,</span>msg<span class="token operator">:</span><span class="token string">'uid error'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 执行sql语句</span>
	pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'DELETE FROM xz_reg WHERE uid=?'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>obj<span class="token punctuation">.</span>uid<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>affectedRows<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code<span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span> msg<span class="token operator">:</span><span class="token string">'del'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
			res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code<span class="token operator">:</span><span class="token number">201</span><span class="token punctuation">,</span>msg<span class="token operator">:</span><span class="token string">'del error'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>删除用户列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>get<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/delete<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	编号: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="项目文件目录-第二种写法"><a href="#项目文件目录-第二种写法" class="header-anchor">#</a> 项目文件目录  （第二种写法）</h2> <div class="language-js extra-class"><pre class="language-js"><code>node_module	 相关包依赖
<span class="token keyword">public</span>  <span class="token operator">--</span>  静态html
routers <span class="token operator">--</span>  路由逻辑实现
app<span class="token punctuation">.</span>js <span class="token operator">--</span> 服务启动
pool <span class="token operator">--</span> 连接池
</code></pre></div><p>app.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//引入自定义模块</span>
<span class="token keyword">const</span> register <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./routes/reg.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> login <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./routes/login.js&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> detail <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./routes/detail.js&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./routes/update.js&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./routes/list.js&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> del <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./routes/del.js&quot;</span><span class="token punctuation">)</span>

<span class="token comment">//创建web服务器 监听</span>
<span class="token comment">//端口</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token comment">//使用body-parser中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    extended<span class="token operator">:</span> <span class="token boolean">false</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">// 使用路由器挂载到 user下</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> register<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> login<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> detail<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> del<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 静态文件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>pool.js</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 引入mysql 模块</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建连接池</span>
<span class="token keyword">var</span> pool <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    host<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
    post<span class="token operator">:</span> <span class="token string">'3306'</span><span class="token punctuation">,</span>
    user<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    database<span class="token operator">:</span> <span class="token string">'xz_lpy'</span><span class="token punctuation">,</span>
    connectionLimit<span class="token operator">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> pool<span class="token punctuation">;</span>
</code></pre></div><p>routers</p> <p>​		&gt; reg.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pool <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../pool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建路由</span>
<span class="token keyword">let</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//注册路由</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/reg&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token number">401</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token operator">:</span> code<span class="token punctuation">,</span>
                msg <span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> Not Null</span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>

    <span class="token comment">// 向数据库中插入数据</span>


    pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO xz_reg SET ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>obj<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        <span class="token comment">// console.log(result);</span>
        <span class="token comment">// console.log(&quot;数据插入成功&quot;);</span>


        <span class="token comment">// 如果数据插入成功响应状态码</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>affectedRows <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
                msg<span class="token operator">:</span> <span class="token string">&quot;reg suc&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 导出路由</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/reg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>用户名:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uname<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- &lt;li&gt;编&amp;nbsp;&amp;nbsp;号:&lt;input type=&quot;text&quot; name=&quot;id&quot;&gt;&lt;/br&gt;&lt;/li&gt; --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>密<span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span>码:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>邮<span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span>箱:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>电<span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span>话:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>phone<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sub<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>注册<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>​			&gt; login.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../pool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">let</span> Login <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



Login<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取数据</span>
    <span class="token keyword">var</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//判断是否为空</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">.</span>uname<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            conde<span class="token operator">:</span> <span class="token number">401</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> <span class="token string">&quot;userName required&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">.</span>upwd<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            conde<span class="token operator">:</span> <span class="token number">402</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> <span class="token string">&quot;Pwssord required&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 执行sql语句</span>
    <span class="token keyword">let</span> sql <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM xz_reg WHERE username = ? AND pwd =?&quot;</span><span class="token punctuation">;</span>
    mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">[</span>obj<span class="token punctuation">.</span>uname<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>upwd<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 判断登录是否成功</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                conde<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
                msg<span class="token operator">:</span> <span class="token string">&quot;Login snc&quot;</span>
                    
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                conde<span class="token operator">:</span> <span class="token number">201</span><span class="token punctuation">,</span>
                msg<span class="token operator">:</span> <span class="token string">&quot;Login err&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Login<span class="token punctuation">;</span> 
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/login<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> 用户名:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uname<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> 密<span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span>码:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>br</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sub<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>登录<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pok<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../index.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Back to homee &gt;&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>​			&gt; List</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../pool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> list <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
    <span class="token comment">/*
    let NumObj = {
        count : parseInt(obj.count),
        pno : parseInt(obj.pno)
    }

    let cont = numObj.cont ? numObj.cont : 5;  // 大小
    let pno = numObj.pno ? numObj.pno : 1; 

    */</span>
    <span class="token keyword">let</span> count <span class="token operator">=</span> obj<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
    <span class="token keyword">let</span> pno <span class="token operator">=</span> obj<span class="token punctuation">.</span>pno<span class="token punctuation">;</span>
    count <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pno <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>pno<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//console.log(NumObj.count, NumObj.pno);</span>
    
    <span class="token comment">// 计算页码 为空添加默认值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pno<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        pno <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 计算页码开始</span>
    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token punctuation">(</span>pno <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> count<span class="token punctuation">;</span>

    <span class="token comment">// sql语句</span>
    <span class="token keyword">let</span> sql <span class="token operator">=</span> <span class="token string">&quot;SELECT *FROM xz_product LIMIT ?,?&quot;</span><span class="token punctuation">;</span>
    mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">[</span>start<span class="token punctuation">,</span>pno<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> list<span class="token punctuation">;</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>GET<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>产品分页:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>
    大小 :<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    页码 :<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pno<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sub<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Select<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>​			&gt; detail.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../pool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> detail <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
detail<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/detail'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            msg<span class="token operator">:</span> <span class="token string">&quot;请输入查询编号&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 查询返回数据</span>


    <span class="token keyword">let</span> sql <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM xz_product WHERE id = ?&quot;</span><span class="token punctuation">;</span>
    mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">[</span>obj<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>

        <span class="token comment">// 判断是否有值</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token operator">:</span> <span class="token number">201</span><span class="token punctuation">,</span>
                msg <span class="token operator">:</span> <span class="token string">&quot;查询商品不存在&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> detail<span class="token punctuation">;</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>GET<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/detail<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>商品查询:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>
         编号:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sub<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Select<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>​		&gt; del.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../pool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> del <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

del<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/del&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token keyword">let</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            code<span class="token operator">:</span> <span class="token number">201</span><span class="token punctuation">,</span>
            msg<span class="token operator">:</span> <span class="token string">&quot;编号不允许为空&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 执行sql语句</span>
    <span class="token keyword">let</span> sql <span class="token operator">=</span> <span class="token string">&quot;DELETE FROM xz_reg WHERE id&quot;</span><span class="token punctuation">;</span>
    mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">[</span>obj<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>affectedRows <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
                msg<span class="token operator">:</span> <span class="token string">&quot;删除成功&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token operator">:</span> <span class="token number">201</span><span class="token punctuation">,</span>
                msg<span class="token operator">:</span> <span class="token string">&quot;删除失败&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> del<span class="token punctuation">;</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>GET<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/detail<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>商品查询:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>
        编号:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sub<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Select<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>​		&gt; update.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../pool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> update <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

update<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/update'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    
    <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token number">401</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token operator">:</span> code<span class="token punctuation">,</span>
                msg<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 不允许为空 </span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        code<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span>  id <span class="token operator">=</span> obj<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    <span class="token keyword">delete</span> obj<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    <span class="token comment">// 使用sql 修改数据</span>
    <span class="token keyword">let</span> sql <span class="token operator">=</span> <span class="token string">&quot;UPDATE xz_reg SET ? WHERE  id = ? &quot;</span><span class="token punctuation">;</span>
    mysql<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">[</span>obj<span class="token punctuation">,</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>affectedRows <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
                msg<span class="token operator">:</span> <span class="token string">&quot;修改成功&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token operator">:</span> <span class="token number">201</span><span class="token punctuation">,</span>
                msg<span class="token operator">:</span> <span class="token string">&quot;修改失败&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> update<span class="token punctuation">;</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/update<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>编<span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span>号:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>用户名:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uname<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>密<span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span>码:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>邮<span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span>箱:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>电<span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span>话:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>phone<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sub<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>修改<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>​</p> <p>​</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.89c9a8ed.js" defer></script><script src="/assets/js/2.cfe6598b.js" defer></script><script src="/assets/js/43.58f28757.js" defer></script><script src="/assets/js/3.fb60532c.js" defer></script>
  </body>
</html>
